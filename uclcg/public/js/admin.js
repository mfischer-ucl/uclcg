/*! uclcg 2021-09-24 */

$(document).ready(function(){var e=io(),t=[],a=!1,d=0,i=function(){e.emit("getAllSetups",{}),e.on("returnAllSetups",function(e){for(var a=JSON.parse(e),d=0;d<a.length;++d)""==a[d].category&&(a[d].category="Default");var i=$("#spaceForSetups");i.empty(),tabbedSetups=[];for(var s="",p=0;p<a.length;++p)0==p&&(s=a[p].category),tabbedSetups[a[p].category]||(tabbedSetups[a[p].category]=[]),tabbedSetups[a[p].category].push(a[p]);t=[],i.append('<ul id="setupTabs" class="nav nav-tabs"></ul>'),i.append('<div id="setupTabsContent" class="tab-content"></div>'),Object.keys(tabbedSetups).forEach(function(e){var a=tabbedSetups[e],d=e==s;d?$("#setupTabs").append('<li class="active" id="tab_'+e+'"><a data-toggle="tab" href="#'+e+'">'+e+"</a></li>"):$("#setupTabs").append('<li id="tab_'+e+'"><a data-toggle="tab" href="#'+e+'">'+e+"</a></li>"),d?$("#setupTabsContent").append('<div id="'+e+'" class="tab-pane fade in active"></div>'):$("#setupTabsContent").append('<div id="'+e+'" class="tab-pane fade"></div>'),$("#"+e).append('<div id="setupRow-'+e+'"class="row display-flex"></div>');for(var i=0;i<a.length;++i){var p=$("#setupRow-"+e),l=a[i].picture,r=a[i].picture.lastIndexOf("/");p.append('<div class="col-xs-12 col-sm-6 col-md-4 col-lg-3">\n                                        <div class=" thumbnail">\n                                            <a id="'+e+"_load_"+i+'" href="#" class="loadButton">\n                                            <img src="'+l.substring(0,r+1)+l.substring(r+1)+'" alt="...">\n                                            </a>\n                                            <div class="caption">\n                                                <h3>'+a[i].niceName+"</h3>\n                                                <p>"+a[i].shortDescription+'</p>\n                                                <p><a id="'+e+"_delete_"+i+'" href="#" class="deleteButton btn btn-primary" role="button">Delete</a></p>\n                                                <p><label style="cursor:pointer"><input id="'+e+"_hidden_"+i+'" type="checkbox" class="hideCheckbox" name="hidden"/> Hidden </label></p>\n                                            </div>\n                                        </div>\n                                      </div>'),t[e+"_delete_"+i]={id:a[i]._id,jsFile:a[i].jsFile},$("#"+e+"_delete_"+i).attr("data-id",a[i]._id),$("#"+e+"_hidden_"+i).attr("data-id",a[i]._id),$("#"+e+"_hidden_"+i).prop("checked",a[i].hidden),$("#"+e+"_delete_"+i).on("click",n),$("#"+e+"_hidden_"+i).change(o)}})})},n=function(d){1!=a&&(a=!0,e.emit("deleteSetup",{id2delete:t[d.currentTarget.id].id}),e.on("setupDeleteSuccessful",function(e){i(),a=!1}))},o=function(t){var a=$(this).attr("data-id"),d=!1;$(this).is(":checked")&&(d=!0),e.emit("hideSetup",{id2hide:a,hide:d})};$("#submitAddSetup").click(function(){var t={};t.niceName=$("#niceNameFormComponent").val(),t.author=$("#authorFormComponent").val(),t.shortDescription=$("#shortDescriptionFormComponent").val(),t.category=$("#categoryFormComponent option:selected").text(),t.picture=$("#pictureFormComponent").get(0).files[0].name,t.jsFile=$("#jsFileFormComponent").get(0).files[0].name;var a=ss.createStream();ss(e).emit("addSetup",a,JSON.stringify(t)),ss.createBlobReadStream($("#pictureFormComponent").get(0).files[0]).pipe(a)}),e.on("addSetupRequestJS",function(){if(!((d+=1)>1)){var t=ss.createStream();ss(e).emit("addSetupJS",t,{}),ss.createBlobReadStream($("#jsFileFormComponent").get(0).files[0]).pipe(t)}}),e.on("invalidStream",function(){d-=1}),e.on("unauthorized",function(){$("#addSetupModal").modal("hide"),$("#loginModal").modal()}),e.on("addSetupSuccess",function(){d-=1,$("#addSetupModal").modal("hide"),$("#addSetupForm").get(0).reset(),i()}),$("#addSetupButton").click(function(){$("#addSetupModal").modal()}),i()});